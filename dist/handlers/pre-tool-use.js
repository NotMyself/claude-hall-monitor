// @bun
import{mkdir as W,appendFile as j}from"fs/promises";import{dirname as v,join as X}from"path";import{fileURLToPath as y}from"url";var B=v(y(import.meta.url)),f=X(B,"..","hooks-log.txt"),V=X(B,"..","logs");function D(q){return X(V,`${q}.txt`)}async function E(){try{await W(V,{recursive:!0})}catch(q){if(q.code!=="EEXIST")throw q}}async function Y(q,z,Q){await E();let K=D(z),J={timestamp:new Date().toISOString(),event:q,session_id:z,data:Q},U=JSON.stringify(J)+`
`;await j(K,U,"utf-8")}async function F(){let q=await Bun.stdin.text();return JSON.parse(q)}function Z(q){console.log(JSON.stringify(q))}var $=0,k=0,x=0,N=30000;async function G(q,z=!1,Q=!1){if(z)k++;if(Q)x++;let K=Date.now();if(K-$<N)return;$=K,await Y("Heartbeat",q,{tool_count:k,message_count:x})}async function P(){let q=await F();await Y("PreToolUse",q.session_id,{cwd:q.cwd,tool_name:q.tool_name,tool_input:q.tool_input,tool_use_id:q.tool_use_id,transcript_path:q.transcript_path,permission_mode:q.permission_mode}),await G(q.session_id,!0,!1),Z({continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"allow"}})}try{await P()}catch(q){console.error("Handler error:",q),Z({continue:!0}),process.exit(1)}
