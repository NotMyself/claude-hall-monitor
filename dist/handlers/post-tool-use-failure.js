// @bun
import{mkdir as W,appendFile as y}from"fs/promises";import{dirname as F,join as K}from"path";import{fileURLToPath as G}from"url";var X=F(G(import.meta.url)),N=K(X,"..","hooks-log.txt"),Y=K(X,"..","logs");function J(q){return K(Y,`${q}.txt`)}async function U(){try{await W(Y,{recursive:!0})}catch(q){if(q.code!=="EEXIST")throw q}}async function Z(q,z,k){await U();let x=J(z),B={timestamp:new Date().toISOString(),event:q,session_id:z,data:k},V=JSON.stringify(B)+`
`;await y(x,V,"utf-8")}async function $(){let q=await Bun.stdin.text();return JSON.parse(q)}function Q(q){console.log(JSON.stringify(q))}async function j(){let q=await $();await Z("PostToolUseFailure",q.session_id,{cwd:q.cwd,tool_name:q.tool_name,tool_input:q.tool_input,tool_use_id:q.tool_use_id,error:q.error,is_interrupt:q.is_interrupt??!1,transcript_path:q.transcript_path,permission_mode:q.permission_mode});let z={continue:!0,hookSpecificOutput:{hookEventName:"PostToolUseFailure",additionalContext:q.is_interrupt?"Tool execution was interrupted by user":`Tool '${q.tool_name}' failed. Error logged for analysis.`}};Q(z)}try{await j()}catch(q){console.error("Handler error:",q),Q({continue:!0}),process.exit(1)}
