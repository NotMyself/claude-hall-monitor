// @bun
import{mkdir as y,appendFile as G}from"fs/promises";import{dirname as J,join as Q}from"path";import{fileURLToPath as U}from"url";var Y=J(U(import.meta.url)),A=Q(Y,"..","hooks-log.txt"),Z=Q(Y,"..","logs");function j(q){return Q(Z,`${q}.txt`)}async function D(){try{await y(Z,{recursive:!0})}catch(q){if(q.code!=="EEXIST")throw q}}async function $(q,z,K){await D();let B=j(z),V={timestamp:new Date().toISOString(),event:q,session_id:z,data:K},W=JSON.stringify(V)+`
`;await G(B,W,"utf-8")}async function k(){let q=await Bun.stdin.text();return JSON.parse(q)}function X(q){console.log(JSON.stringify(q))}function E(q,z=500){if(typeof q!=="string"){let K=JSON.stringify(q);if(K.length>z)return K.substring(0,z)+"... [truncated]";return K}if(q.length>z)return q.substring(0,z)+"... [truncated]";return q}async function F(){let q=await k();await $("PostToolUse",q.session_id,{cwd:q.cwd,tool_name:q.tool_name,tool_input:q.tool_input,tool_use_id:q.tool_use_id,response_preview:E(q.tool_response),response_type:typeof q.tool_response,transcript_path:q.transcript_path,permission_mode:q.permission_mode}),X({continue:!0})}try{await F()}catch(q){console.error("Handler error:",q),X({continue:!0}),process.exit(1)}
