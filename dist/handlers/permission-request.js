// @bun
import{mkdir as W,appendFile as y}from"fs/promises";import{dirname as F,join as K}from"path";import{fileURLToPath as G}from"url";var X=F(G(import.meta.url)),N=K(X,"..","hooks-log.txt"),Y=K(X,"..","logs");function J(q){return K(Y,`${q}.txt`)}async function U(){try{await W(Y,{recursive:!0})}catch(q){if(q.code!=="EEXIST")throw q}}async function Z(q,z,k){await U();let x=J(z),B={timestamp:new Date().toISOString(),event:q,session_id:z,data:k},V=JSON.stringify(B)+`
`;await y(x,V,"utf-8")}async function $(){let q=await Bun.stdin.text();return JSON.parse(q)}function Q(q){console.log(JSON.stringify(q))}async function j(){let q=await $();await Z("PermissionRequest",q.session_id,{cwd:q.cwd,tool_name:q.tool_name,tool_input:q.tool_input,has_suggestions:Array.isArray(q.permission_suggestions)&&q.permission_suggestions.length>0,suggestion_count:q.permission_suggestions?.length??0,transcript_path:q.transcript_path,permission_mode:q.permission_mode,requested_at:new Date().toISOString()}),Q({continue:!0})}try{await j()}catch(q){console.error("Handler error:",q),Q({continue:!0}),process.exit(1)}
